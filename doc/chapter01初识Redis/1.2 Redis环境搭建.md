# Redis在Windows下的安装(了解)

Redis官方只有linux版本，微软开发维护了一款win版本：[redis](https://github.com/MicrosoftArchive/redis)

![image-20240228205016101](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402282144394.png)

但是已经停止更新了，最新的一次更新还是redis3.0.5

由于这个版本中还未支持geospatial地理位置的使用，这里我找到一份windows版的redis6.2.6

链接：https://pan.baidu.com/s/13cJV6H2ZimiZvJPblweBaQ?pwd=1234 
提取码：1234

## 1.下载

下载redis-6.2.6-win.zip进行解压，可以看到Redis文件夹有如下文件

![image-20240228210120633](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402282144057.png)

Redis的可执行命令和配置文件用途说明。

- redis-benchmark.exe：测试工具，测试Redis的读写性能情况

- redis-check-aof.exe： 用于检查 Redis AOF (Append Only File) 文件的工具。这个工具用来验证 AOF 文件的格式是否正确，以及是否和当前的 Redis 数据保持一致。

- redis-check-rdb.exe： 用于检查 Redis RDB 文件的工具，它可以帮助你检查 RDB 文件的完整性和一致性。

- redis-cli.exe ：Redis客户端程序

- redis-server.exe：Redis服务器程序

- redis.windows.conf：Redis在Windows下的配置文件，主要是一些Redis的默认服务配置，包括默认端口号（6379）等

## 2.启动服务端

在Redis所在目录执行cmd命令

或者按Win+R组合键运行cmd命令，使用cd命令切换到Redis目录下

![image-20240228212110137](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402282144032.png)

执行一下命令，直接启动redis服务。

```
redis-server.exe redis.conf
```

如果报以下错误，则是端口冲突了。可以百度解决端口冲突或修改redis.conf中port的端口

![image-20240228213824414](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402282144766.png)

正常启动：

![image-20240228214351046](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402282144448.png)

运行redis-server命令启动的是Redis服务，是在前台控制台直接运行的，也就是说，执行完该命令后，如果关闭当前命令行窗口，Redis服务也会相应的关闭。

==注：win版的redis就不设置后台启动和自动启动了，后续的文章统一使用linux版的redis。==

## 3.启动客户端

重新启动一个控制台窗口，原来的控制台窗口不要关闭，不然就无法访问Redis服务器了。在新的cmd控制台窗口运行以下命令启动Redis客户端。

```
redis-cli.exe -h 127.0.0.1 -p 6379
```

客户端基本参数介绍

-h：设置主机ip地址，默认为127.0.0.1

-p：设置主机的端口号，默认为6379

## 4停止服务端

在Redis客户端输入shutdown命令，会关闭Redis服务器，然后持久化Redis内存中的数据到文件

![image-20240228215745398](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402282202671.png)

redis客户端断开连接，redis服务端关闭，并且在关闭前进行了RDB持久化

![image-20240228215827087](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402282202835.png)

此时redis文件夹中生成了一个dump.rdb的转储文件

![image-20240228215919215](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402282202192.png)

关于redis的持久化在后续文章中会进行详细的讲解，这里只做了解即可。

# Redis在linux下的安装

==提示：需了解linux语CentOS相关的操作。==

| Redis官方网站                          |
| -------------------------------------- |
| [**http://redis.io**](http://redis.io) |

## 安装版本

点击Redis官方网站，点击Download

![image-20240229073324898](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291317110.png)

选择更多下载选项

![image-20240229073343010](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291317643.png)

可以选择download推荐的6.X版本，

![image-20240229074229452](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291318756.png)

如果想要下载指定版本redis可以到github下载：

https://github.com/redis/redis

对应redis6.2.6版本：

https://github.com/redis/redis/releases/tag/6.2.6

## 安装步骤

### 1下载安装最新版的gcc编译器

```
yum install -y gcc
```

### 2.安装redis之前需要具备c++库环境

```
yum -y install gcc-c++
```

### 3..将下载redis-6.2.6.tar.gz放入linux下的/opt目录

![image-20240229130501569](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291318610.png)

### 4.解压完成后进入redis-6.2.6目录

```
tar -zxvf redis-6.2.6.tar.gz
```

redis6.2.6的目录结构如下

![image-20240229130633235](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291318969.png)

- Makefile:编译配置文件，用于构建Redis

- redis.conf：Redis服务器的配置文件。主要是一些Redis的默认服务配置，包括默认端口号（6379）等

- sentinel.conf：Sentinel配置文件，用于配置Redis Sentinel。
- src：源代码文件夹，包含Redis的源代码文件。

### 5.编译并安装Redis

可以使用make&&make install命令一起执行 进行编译并安装

### 6.安装成功后，Redis默认安装目录为：/usr/local/bin

redis默认安装到/usr/local/bin目录下

linux下的/usr/local类似于windows系统的C:\Program Files

![image-20240229130944231](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291318688.png)

Redis的可执行命令和配置文件用途说明。

- redis-benchmark：测试工具，测试Redis的读写性能情况
- redis-check-aof： 文件修复攻击，用于检查 Redis AOF (Append Only File) 文件的工具。这个工具用来验证 AOF 文件的格式是否正确，以及是否和当前的 Redis 数据保持一致。
- redis-check-rdb： 文件修复攻击，用于检查 Redis RDB 文件的工具，它可以帮助你检查 RDB 文件的完整性和一致性。
- redis-cli ：Redis客户端程序
- redis-sentinel：Redis sentinel集群使用
- redis-server.exe：Redis服务器程序

### 7.前台启动

前台启动，命令行窗口不能关闭，否则服务器停止

```
redis-server
```

![image-20240229131119733](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291318106.png)

默认读取/opt/redis-6.2.6/redis.conf配置文件，如果redis.conf不在默认位置或者想要指定配置位置

```
redis-server /opt/redis-6.2.6/redis.conf
```

![image-20240229131255640](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291318395.png)

这个界面将占用命令行，退出请按"Ctrl + C"组合键

### 8.后台启动

如果想要后台启动，需要修改redis.conf配置文件

#### 8.1备份redis.conf

备份配置文件，以备不时之需

```
cp redis.conf redis.conf.bck
```

![image-20240229131510878](https://gitee.com/dongguo4812_admin/image/raw/master/image/202402291318942.png)

#### 8.2修改配置

```
vim redis.conf
```

这里我修改了四处

一、修改监听的地址

```
bind 0.0.0.0
```

默认127.0.0.1，导致只能在本地访问。修改为0.0.0.0则可以在任意ip访问，注意生产环境不要设置为0.0.0.0，这意味着Redis将监听包括公网和私网在内的所有IP地址。

这种设置存在安全风险，因此需要结合其他安全措施使用，比如设置密码、启用TLS/SSL加密、配置防火墙等。

**拓展：**

redis.conf的bind设置取决于Redis服务器的预期用途和网络配置。以下是一些常见的设置场景：

1.本地访问（默认设置）：如果Redis仅用于本地应用程序访问，可以将bind设置为默认的127.0.0.1，这会限制Redis仅接受来自本机的连接。

```
bind 127.0.0.1     
```

2.同一私有网络内的访问：如果Redis需要被同一个私有网络内的多个服务器访问，可以将bind设置为服务器的私有IP地址。这样，只有同一网络内的服务器才能访问Redis服务。

```
bind 192.168.1.100     
```

3.公网上的访问：如果Redis需要被公网上的其他服务器访问，可以将bind设置为服务器的公网IP地址。不过，这样做会带来安全风险，因为Redis将对所有公网上的请求开放。通常不推荐直接在公网上暴露Redis服务，除非你有相应的安全措施，比如防火墙规则、SSL加密连接等。

```
  bind 52.1.2.3  
```

4.监听所有接口：如果你希望Redis能够接受来自服务器上所有网络接口的连接，可以将bind设置为0.0.0.0。这意味着Redis将监听包括公网和私网在内的所有IP地址。这种设置同样存在安全风险，因此需要结合其他安全措施使用，比如设置密码、启用TLS/SSL加密、配置防火墙等。

```
bind 0.0.0.0
```

二、将redis设置为守护进程

```
daemonize yes
```

修改为yes后redis即可后台运行

三、设置redis的密码

这里将redis的密码设置为root

```
requirepass root
```

四、设置日志文件位置

```
logfile "redis.log"
```

默认为logfile ""

指定日志文件的名称。使用空字符串来强制 Redis 将日志输出到标准输出设备（如屏幕），如果您使用标准输出进行日志记录并启用了守护进程模式，日志将被发送到 /dev/null（即被丢弃）。

#### 8.3启动redis服务

```
redis-server redis.conf
```

没有报错证明启动成功。可以查看redis进程确定是否启动成功

```
ps -ef|grep redis
```

#### 8.4启动redis客户端

```
redis -cli -a root -p 6379
```



警告：在命令行界面上使用带有'-a'或'-u'选项的密码可能不安全。

这个警告是因为在命令行中使用-a（用于认证密码）或-u（用于指定用户名）选项时，密码和用户名可能会被记录在命令历史中，或者在进程列表中变得可见，这可能会导致敏感信息泄露给其他用户。

为了提高安全性，建议避免在命令行中直接使用密码



如果觉得看到这个警告不爽，你想要解决这个警告，那该怎么办呢？

那么有两种方式

第一种方式：

shell的标准输出包含两种 1：标准输出， 2：标准错误，我们需要把2标准错误给去除

在设置日志文件位置时提及过使用空字符串来强制 Redis 将日志输出到标准输出设备（如屏幕），如果您使用标准输出进行日志记录并启用了守护进程模式，日志将被发送到 /dev/null（即被丢弃）。我们可以在执行命令时将标准错误发送到/dev/null，将标准错误丢弃。`/dev/null` 是一个特殊的文件，用于丢弃所有写入其中的数据

```
redis -cli -a root -p 6379 2>/dev/null
```





第二种方式：在命令行中不使用-a  先连接后输入密码

```
redis -cli -p 6379
```

再使用auth命令输入密码

```
auth root
```

再次操作就可以了。

### 9.退出客户端

```
quit
```

退出redis客户端连接， 并没有关闭服务器

### 10.关闭服务端

客户端连接时用shutdown



未连接客户端在usr/local/bin下

单实例关闭

```
redis-cli -a root shutdown

quit
```

多实例关闭，指定端口关闭

```
redis-cli -p 6379 shutdown
quit
```

当然还可以使用kill -9 <PID>命令杀死进程

```
kill -9 
```

### 11.redis开机自启

#### 11.1创建redis.service

```
vi /etc/systemd/system/redis.service
```

Redis服务的systemd配置文件

```
[Unit]
Description=redis-server
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/bin/redis-server /opt/redis-6.2.6/redis.conf
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

#### 11.2重载系统服务

```
systemctl daemon
```

现在，我们可以用下面这组命令来操作redis了：

```
# 启动
systemctl start redis
# 停止
systemctl stop redis
# 重启
systemctl restart redis
# 查看状态
systemctl status redis
```

#### 11.3执行下面的命令，可以让redis开机自启：

```
systemctl enable redis
```

