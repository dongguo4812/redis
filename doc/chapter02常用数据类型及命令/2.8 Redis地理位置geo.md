# 介绍

geo主要用于存储地理位置信息，并对存储的信息进行操作，包括

- 添加地理位置的坐标
- 获取地理位置的坐标
- 计算两个位置之间的距离
- 根据用户给定的经纬度坐标来获取指定范围内的地理位置集合

核心思想就是将球体转换为平面，将三维的地球变为二维的坐标，然后将二维的坐标转换为一维的点块。

![image-20240302154825250](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403021548754.png)

如何获得地理位置的经纬度呢？

https://api.map.baidu.com/lbsapi/getpoint/index.html   可使用地理坐标系统获取具体经纬度

# 常见命令

## GEOADD

geoadd用于存储指定的地理空间位置,可以将一个或多个经度(longitude)、纬度(latitude)、位置名称(member)添加到指定的key中

```shell
127.0.0.1:6379> GEOADD city 116.403963 39.915119 "天安门" 116.403414 39.924091 "故宫" 116.024067 40.362639 "长城"
(integer) 3
```

## GEOPOS

geopos 用于从给定的 key 里返回所有指定名称(member）的位置（经度和纬度），不存在的返回 nil。

```shell
127.0.0.1:6379> geopos city 天安门
1) 1) "116.40396326780319214"
   2) "39.91511970338637383"
127.0.0.1:6379> geopos city 故宫
1) 1) "116.40341609716415405"
   2) "39.92409008156928252"
```

## GEOHASH

Redis GEO 使用 geohash 来保存地理位置的坐标（生成base32编码值）。

geohash 用于获取一个或多个位置元素的 geohash 值。

```shell
127.0.0.1:6379> geohash city 天安门
1) "wx4g0f6f2v0"
```



## GEODIST

GEODIST key member1 member2 [m|km"ft"mi]返回两个给定位置之间的距离

m：米；km: 千米；ft: 英尺;mi: 英里；不填默认为米

```shell
127.0.0.1:6379> geodist city 天安门 长城 km
"59.3390"
127.0.0.1:6379> geodist city 天安门 长城 m
"59338.9814"
```



## GEORADIUS

以给定的经纬度为中心，返回与中心的距离不超过给定最大距离的所有位置元素，并支持多种查询方式，如按距离、按哈希值等。

```shell
GEORADIUS key 经度 纬度 距离 <M | KM | FT | MI> [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count [ANY]] [ASC | DESC] [STORE key | STOREDIST key]
```

WITHDIST：在返回位置元素的同时，将位置元素与中心之间的距离也一并返回。距离的单位和用户给定的范围单位保持一致。

WITHCOORD：将位置元素的经度和维度也一并返回。

WITHHASH：以52位有符号整数的形式，返回位置元素经过原始geohash编码的有序集合分值。这个选项主要用于底层应用或者调试，实际中的作用并不大COUNT 限定返回的记录数。



假如张三所在位置是北京王府井(116.418017 39.914402) ,给出距离10千米内存在的位置。

```shell
127.0.0.1:6379> georadius city 116.418017 39.914402 10 km withdist withcoord count 10
1) 1) "\xe5\xa4\xa9\xe5\xae\x89\xe9\x97\xa8"
   2) "1.2016"
   3) 1) "116.40396326780319214"
      2) "39.91511970338637383"
2) 1) "\xe6\x95\x85\xe5\xae\xab"
   2) "1.6470"
   3) 1) "116.40341609716415405"
      2) "39.92409008156928252"
```

返回中存在中文乱码，可以在启动客户端时，带上--raw解决中文乱码

```shell
127.0.0.1:6379> quit
[root@redis ~]# redis-cli -a root --raw
Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe.
127.0.0.1:6379> georadius city 116.418017 39.914402 10 km withdist withcoord count 10
天安门
1.2016
116.40396326780319214
39.91511970338637383
故宫
1.6470
116.40341609716415405
```

## GEORADIUSBYMEMBER

GEORADIUSBYMEMBER 跟GEORADIUS类似，找出位于指定范围内的元素，中心点是由给定的位置元素决定（一个给出经纬度，一个给出地名）

```shell
127.0.0.1:6379> georadiusbymember city 天安门 10 km withdist withcoord count 10
天安门
0.0000
116.40396326780319214
39.91511970338637383
故宫
0.9988
116.40341609716415405
39.92409008156928252
```

# 应用场景

滴滴打车，实时记录更新车辆的位置