# 介绍

HyperLogLog用来做基数统计的算法，HyperLogLog的优点:在输入元素的数量或者体积非常大时，计算基数所需要的空间总是固定且很小的。

每个HyperLogLog键只需要花费12kb内存，就可以计算接近2的64次方个不同元素的基数，

HyperLogLog 只会根据输入元素来计算基数，不会储存输入元素的本身，所以HyperLogLog不像集合那样，返回输入的各个元素

通过牺牲准确率来换取空间，对于不要求绝对准确率的场景下可以使用，因为概率算法不直接存储数据本身，通过一定的概率统计方法预估基数值，同时保证误差在一定范围内，由于又不储存数据故此可以大大节约内存。

HyperLogLog就是一种概率算法的实现。牺牲准确率来换取空间，误差仅仅只是0.81%左右

HyperLogLog 的标准误差为 1.04/sqrt（m)，其中“m”是使用的寄存器数。Redis使用了16384个寄存器，所以标准误差是0.81%。



# 常见命令

## PFADD

PFADD key element： 添加指定元素到HyperLogLog

```shell
127.0.0.1:6379> pfadd jd:spu1 1 2 5 
(integer) 1
127.0.0.1:6379> pfadd jd:spu2 1 1 2 2 3 3
(integer) 1
```



## PFCOUNT

 返回基数计算值

```shell
127.0.0.1:6379> pfcount jd:spu1
(integer) 3
127.0.0.1:6379> pfcount jd:spu2
(integer) 3
```

## PFMERGE

PFMERGE destkey sourcekey 将多个HyperLogLog 合并到一个指定的HyperLogLog

```shell
127.0.0.1:6379> pfmerge result jd:spu1 jd:spu2
OK
127.0.0.1:6379> pfcount result
(integer) 4
```



# 应用场景

统计网站的UV（独立访客）