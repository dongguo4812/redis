# 介绍

String类型，也就是字符串类型，是Redis中最简单的存储类型。

其value是字符串，不过根据字符串的格式不同，又可以分为3类：

- string：普通字符串
- int：整数类型，可以做自增、自减操作
- float：浮点类型，可以做自增、自减操作

不管是哪种格式，底层都是字节数组形式存储，只不过是编码方式不同。字符串类型的最大空间不能超过512m.

# 常见命令

## SET 

```
SET key value [NX | XX] [GET] [EX seconds | PX milliseconds |
  EXAT unix-time-seconds | PXAT unix-time-milliseconds | KEEPTTL]
```

SET命令有EX、PX、NX、XX以及KEEPTTL五个可选参数，其中KEEPTTL为6.0版本添加的可选参数，其它为2.6.12版本添加的可选参数。

- NX：键不存在的时候设置键值，如果键已存在，则不执行任何操作返回nil。
- XX：键存在的时候设置键值，如果键不存在，则不执行任何操作返回nil。
- GET:返回指定键修改前的值，若键不存在时返回nil

- Ex seconds：以秒为单位设置过期时间

- PX milliseconds：以毫秒为单位设置过期时间

- EXAT unix-time-seconds: 设置以秒为单位的UNIX时间戳所对应的时间为过期时间

- PXAT unix-time-milliseconds: 设置以毫秒为单位的UNIX时间戳所对应的时间为过期时间

- KEEPTTL：保留键的现有过期时间

  

SET命令使用EX、PX、NX参数，其效果等同于SETEX、PSETEX、SETNX命令。根据官方文档的描述，未来版本中SETEX、PSETEX、SETNX命令可能会被淘汰。EXAT、PXAT以及GET为Redis 6.2新增的可选参数。



返回值：

设置成功则返回OK；返回nil为未执行SET命令，如不满足NX、XX条件等。若使用GET参数，则返回该键原来的值，或在键不存在时返回nil。

### set key value 

设定key持有指定的字符串value，如果该key存在则进行覆盖操作。总是返回”OK”

```shell
127.0.0.1:6379> set k1 v1
OK
127.0.0.1:6379> get k1
"v1"
127.0.0.1:6379> ttl k1
(integer) -1
```

过期时间为-1：表示设置的key没有过期时间。

### set key value  NX

键不存在的时候设置键值，如果键已存在，则不执行任何操作返回nil。

```shell
127.0.0.1:6379> set k2 v2 nx
OK
127.0.0.1:6379> set k2 v2 nx
(nil)
```

### set key value  XX

键存在的时候设置键值，如果键不存在，则不执行任何操作返回nil。

```shell
127.0.0.1:6379> set k1 v11 xx
OK
127.0.0.1:6379> set k11 v11 xx
(nil)
```

### set key value  GET 

返回指定键修改前的值，若键不存在时返回nil

```shell
127.0.0.1:6379> set k1 v1 get
"v11"
127.0.0.1:6379> get k1
"v1"
```

### set key value  EX seconds

以秒为单位设置过期时间，key过期返回-2

```shell
127.0.0.1:6379> set k1 v1 ex 10
OK
127.0.0.1:6379> ttl k1
(integer) 8
127.0.0.1:6379> ttl k1
(integer) 4
127.0.0.1:6379> ttl k1
(integer) -2
```

### set key value  PX milliseconds

以毫秒为单位设置过期时间

```shell
127.0.0.1:6379> set k1 v1 px 10000
OK
127.0.0.1:6379> ttl k1
(integer) 8
127.0.0.1:6379> ttl k1
(integer) 4
127.0.0.1:6379> ttl k1
(integer) -2
```

### set key value  EXAT unix-time-seconds

设置以秒为单位的UNIX时间戳所对应的时间为过期时间

1709258066比当前UNIX时间戳1709258046增加了20秒

```shell
127.0.0.1:6379> set k1 v1 exat 1709258066
OK
127.0.0.1:6379> ttl k1
(integer) 2
127.0.0.1:6379> ttl k1
(integer) -2
```

### set key value  PXAT unix-time-milliseconds

设置以毫秒为单位的UNIX时间戳所对应的时间为过期时间

1709258163626比当前UNIX时间戳1709258143626增加了2000毫秒

```shell
127.0.0.1:6379> set k1 v1 pxat 1709258163626
OK
127.0.0.1:6379> ttl k1
(integer) 6
127.0.0.1:6379> ttl k1
(integer) -2
```

**如何获得当前指定key过期的Unit时间呢？**

获取当前时间戳，增加的值就是对应的过期时间

```java
//以秒为单位的UNIX时间戳
System.out.println(System.currentTimeMillis() / 1000);
//以毫秒为单位的UNIX时间戳
System.out.println(System.currentTimeMillis());
```

### set key value KEEPTTL

当对已经设置过期时间的key再次进行设置时，保留之前设置的过期时间

使用set key value命令设置会将key的过期时间设置为-1，如果想要继承之前的过期时间，需要使用set key value KEEPTTL命令

```shell
127.0.0.1:6379> set k1 v1 ex 30
OK
127.0.0.1:6379> ttl k1
(integer) 28
127.0.0.1:6379> set k1 v11 keepttl
OK
127.0.0.1:6379> ttl k1
(integer) 15
```

## GET

根据key获取String类型的value

```shell
127.0.0.1:6379> set k1 v1
OK
127.0.0.1:6379> get k1
"v1"
```

## MSET：

批量添加多个String类型的键值对

```shell
127.0.0.1:6379> mset k1 v1 k2 v2 k3 v3
OK
127.0.0.1:6379> get k1
"v1"
127.0.0.1:6379> get k2
"v2"
127.0.0.1:6379> get k3
"v3"
```

## MGET

根据多个key获取多个String类型的value

```shell
127.0.0.1:6379> mset k1 v1 k2 v2 k3 v3
OK
127.0.0.1:6379> mget k1 k2 k3
1) "v1"
2) "v2"
3) "v3"
```

## MSETNX

批量添加一个String类型的键值对，前提是这个key不存在，否则不执行。

如果key存在任意一个，都不执行。key全部不存在，才执行成功。

```shell
127.0.0.1:6379> set k1 v1
OK
127.0.0.1:6379> msetnx k1 v1 k4 v4
(integer) 0
127.0.0.1:6379> msetnx k4 v4 k5 v5
(integer) 1
```

## GETRANGE

获取指定区间范围的值，类似java中的substring。

GETRANGE命令不会修改任何数据，只是返回请求范围内的字节序列。

getrange k1 0 -1表示获取全部内容

getrange k1 0 3表示获取索引0到索引3的内容

如果指定的键不存在或不存在内容，命令将返回一个空字符串。

```shell
127.0.0.1:6379> set k1 abcd1234
OK
127.0.0.1:6379> getrange k1 0 -1
"abcd1234"
127.0.0.1:6379> getrange k1 0 3
"abcd"
127.0.0.1:6379> getrange k1 99 100
""
```

## SETRANGE

用 <value> 覆写<key>所储存的字符串值，从<起始位置>开始(索引从0开始)。

setrange k1 1 efg 从索引1进行复写

```shell
127.0.0.1:6379> get k1
"abcd1234"
127.0.0.1:6379> setrange k1 1 efg
(integer) 8
127.0.0.1:6379> get k1
"aefg1234"
```

## INCR

将指定的key的value原子性的递增1.如果该key不存在，其初始值为0，在incr之后其值为1。如果value的值不能转成整型，如hello，该操作将执行失败并返回相应的错误信息。

```shell
127.0.0.1:6379> set k1 100
OK
127.0.0.1:6379> get k1
"100"
127.0.0.1:6379> incr k1
(integer) 101
127.0.0.1:6379> get k1
"101"
127.0.0.1:6379> set k2 v2
OK
127.0.0.1:6379> incr k2
(error) ERR value is not an integer or out of range
127.0.0.1:6379> get k6
(nil)
127.0.0.1:6379> incr k6
(integer) 1
127.0.0.1:6379> get k6
"1"
```

## DECR

将指定的key的value原子性的递减1.如果该key不存在，其初始值  为0，在incr之后其值为-1。如果value的值不能转成整型，如hello，该操作将执行失败并返回相应的错误信息。

```shell
127.0.0.1:6379> set k1 100
OK
127.0.0.1:6379> get k1
"100"
127.0.0.1:6379> decr k1
(integer) 99
127.0.0.1:6379> get k1
"99"
```

## INCRBY

将指定的key的value原子性增加指定步长，如果该 key不存在，初始值为0，在incrby之后，该值为步长值。如果该值不能转成整型，如hello则失败并返回错误信息

```shell
127.0.0.1:6379> set k1 100
OK
127.0.0.1:6379> get k1
"100"
127.0.0.1:6379> incrby k1 10
(integer) 110
127.0.0.1:6379> get k1
"110"
```

## DECRBY

将指定的key的value原子性减少指定步长，如果该key不存在，初始值为0，在decrby之后，该值为负的步长值。如果该值不能转成整型，如hello则失败并返回错误信息

```shell
127.0.0.1:6379> set k1 100
OK
127.0.0.1:6379> get k1
"100"
127.0.0.1:6379> decrby k1 10
(integer) 90
```



INCRBY:让一个整型的key自增并指定步长，例如：incrby num 2 让num值自增2

- INCRBYFLOAT：让一个浮点类型的数字自增并指定步长
- SETNX：添加一个String类型的键值对，前提是这个key不存在，否则不执行
- SETEX：添加一个String类型的键值对，并且指定有效期

## STRLEN

获取字符串长度

```shell
127.0.0.1:6379> strlen k1
(integer) 8
```

## APPEND

**将给定的值追加到原值的末尾**

```shell
127.0.0.1:6379> set k1 abcd
OK
127.0.0.1:6379> append k1 1234
(integer) 8
127.0.0.1:6379> get k1
"abcd1234"
```

## SETNX

全称是 SET if Not eXists，这个命令用于在键不存在时设置键值对。

```shell
127.0.0.1:6379> get k1
(nil)
127.0.0.1:6379> setnx k1 v1
(integer) 1
127.0.0.1:6379> setnx k1 v1
(integer) 0
```

**可参考set key value NX命令**

## SETEX

全称是 SET with EXpiration，这个命令用于设置一个带有过期时间的键值对。

```shell
127.0.0.1:6379> setex k1 10 v1
OK
127.0.0.1:6379> ttl k1
(integer) 7
127.0.0.1:6379> ttl k1
(integer) -2
```

**可参考set key value EX seconds命令**

在实现分布式锁时，通常会将 SETNX 和 SETEX 结合起来使用。首先使用 SETNX尝试获取锁，如果成功获取到锁（即键之前不存在），再使用 SETEX为该键设置一个过期时间。

通常为了保证获取锁和设置过期时间的操作原子性，使用以下命令。

```shell
set key value [EX seconds] NX
```

这样既保证了锁的原子性，又确保了锁能够在适当的时候自动释放。

## GETSET

设置了新值同时获得旧值。

```shell
127.0.0.1:6379> set k1 v1
OK
127.0.0.1:6379> get k1
"v1"
127.0.0.1:6379> getset k1 v2
"v1"
127.0.0.1:6379> get k1
"v2"
```

**可参考set key value GET命令**

# 应用场景

淘宝商品的点击量

文章的阅读量

分布式锁
