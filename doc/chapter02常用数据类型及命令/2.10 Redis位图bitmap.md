# 介绍

由0和1状态表现的二进制位的bit数组。

![image-20240302134323179](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403021343773.png)

用String类型作为底层数据结构实现的一种统计二值状态的数据类型

位图不是实际的数据类型，位图本质是数组，它是基于String数据类型的按位的操作。该数组由多个二进制位组成，每个二进制位都对应一个偏移量(我们称之为一个索引)。

Bitmap支持的最大位数是2^32位，它可以极大的节约存储空间，使用512M内存就可以存储多达42.9亿的字节信息（2^32=4294967296）

# 常见命令

## SETBIT

setbit key offset val：给指定key的值的第offset位赋值val， offset 偏移量是从零开始算，val只能为0或1.

可以看出命令的返回值为修改前的值

```shell
127.0.0.1:6379> setbit k1 1 1
(integer) 0
127.0.0.1:6379> setbit k1 3 1
(integer) 0
127.0.0.1:6379> setbit k1 3 0
(integer) 1
```



## GETBIT

getbit key offset： 获取指定key的第offset位的值

```shell
127.0.0.1:6379> getbit k1 0
(integer) 0
127.0.0.1:6379> getbit k1 1
(integer) 1
```

**注：redis里用type命令查看bitmap是string类型，使用get key 获得二进制的ascii编码值**

```shell
127.0.0.1:6379> type k1
string
127.0.0.1:6379> get k1
"P"
```

## STRLEN

统计占用多少字节，8个二进制位1个字节（byte）。

超过8位（1个字节）会进行扩容至16位（2个字节）

```shell
127.0.0.1:6379> setbit k1 7 1
(integer) 0
127.0.0.1:6379> strlen k1
(integer) 1
127.0.0.1:6379> setbit k1 8 1
(integer) 0
127.0.0.1:6379> strlen k1
(integer) 2
```

## BITCOUNT 

键中1的个数  

```shell
127.0.0.1:6379> bitcount k1
(integer) 3
```

## BITOP

bitop operation destkey key：对对个键进行位运算（AND、OR、NOT、XOR），并将结果存储在destkey中

假如某个网站，每天都会记录用户的签到情况，统计用户的签到记录。查找出连续2天都签到的记录。

```shell
127.0.0.1:6379> setbit 20240304 1 1
(integer) 0
127.0.0.1:6379> setbit 20240304 2 1
(integer) 0
127.0.0.1:6379> setbit 20240304 5 1
(integer) 0
127.0.0.1:6379> setbit 20240305 1 1
(integer) 0
127.0.0.1:6379> setbit 20240305 3 1
(integer) 0
127.0.0.1:6379> setbit 20240305 5 1
(integer) 0
127.0.0.1:6379> bitop and destkey 20240304 20240305
(integer) 1
127.0.0.1:6379> getbit destkey 1
(integer) 1
127.0.0.1:6379> getbit destkey 2
(integer) 0
127.0.0.1:6379> getbit destkey 3
(integer) 0
127.0.0.1:6379> getbit destkey 4
(integer) 0
127.0.0.1:6379> getbit destkey 5
(integer) 1
```

这里将offset对应的值，当做用户的id号。

20240304：1、2、5号用户进行了签到

20240305：1、3、5号用户进行了签到 

进行与运算后，将结果存储在目标键destkey中。

连续2天都签到的是1、5号用户。

# 应用场景

钉钉打卡签到统计

视频是否被点击观看过