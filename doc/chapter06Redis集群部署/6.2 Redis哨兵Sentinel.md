# 思考

Redis主从架构，slave节点宕机恢复后可以找master节点同步数据，那么master节点宕机怎么办？

主从集群下，无法自动进行主从切换，master节点挂掉，该主从集群无法执行写操作，只能执行读操作。

引出哨兵：

使用哨兵Sentinel监控master是否故障，如果故障了根据投票数选举自动将某一个从库转换成新主库，继续对外服务。

# Redis哨兵

Redis提供了哨兵（Sentinel）机制来实现主从集群的自动故障恢复。

## 作用

- 监控：Sentinel 会不断检查您的master和slave是否正常工作，监控Redis的运行状态。

- 自动故障转移：当master宕机后，实现故障转移，自动将slave切换成新的master。当故障实例回复后会切换成slave以新的master为主。

- 消息通知：当集群发生故障转移时，Sentinel会将故障转移的结果噶送给所有连接到它的Redis客户端。

- 配置中心：提供和维护集群的配置信息，如节点地址、角色等。确保客户端能够正确地连接到Redis节点

# 搭建哨兵集群

这里我们搭建一个三个节点形成的Sentinel集群，来监管之前的Redis主从集群。

三个sentinel实现自动监控和维护集群，不存放数据

实例信息如下：

以192.168.122.132实例克隆出三个新的实例

| 节点 | IP              |
| ---- | --------------- |
| s1   | 192.168.122.135 |
| s2   | 192.168.122.136 |
| s3   | 192.168.122.137 |

## 配置sentinel