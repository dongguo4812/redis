单节点Redis的并发能力是有上限的，要进一步提高Redis的并发能力，就需要搭建主从模式，实现读写分离。

主从复制也叫主从模式，当用户往Master端写入数据时，通过Redis Sync机制将数据文件发送至Slave，Slave也会通过Redis Sync机制将数据文件发送至Master以确保数据一致，来实现Redis的主从复制。如果Master和Slave之间的链接出现断连现象，Slave可以自动重连Master，但是在连接成功之后，一次完全同步将被自动执行。

在主从复制配置后，Master（主节点）可以负责读写服务，Slave（从节点）只负责读服务。Redis复制在Master 这一端是非阻塞的，也就是说在和Slave 同步数据的时候，Master仍然可以执行客户端的操作命令而不受其影响

# 作用

- 读写分离
- 容灾恢复
- 数据备份
- 水平扩容支撑高并发

# 相关细节

## 1.配置从库

主从复制只需要配置从库即可，不用配置主库

## 2.权限细节

master如果配置了requirepass密码参数，需要密码登录。

那么slave就要配置masterauth来设置校验密码，否则master会拒绝slave的访问请求

## 3.操作命令

### info  replication

查看复制节点的主从关系和配置信息

### replicaof 主库ip 主库端口

指定主库，一般在redis.conf配置文件中配置

### slaveof 主库ip 主库端口

`replicaof` 和 `slaveof` 都是用来配置从服务器（slave）追踪主服务器（master）的命令。不过，`slaveof` 是早期Redis版本中的命令，而 `replicaof` 是在较新的版本中引入的，作为 `slaveof` 的替代品。

从Redis 6开始，`slaveof` 命令已被弃用，并推荐使用 `replicaof` 命令来配置主从复制。

### slaveof no one

使当前数据库停止与其他数据库的同步，转成主数据库（单机）

# 搭建主从架构

![image-20240305141100882](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403051411833.png)