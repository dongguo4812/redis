# Redis的主要性能瓶颈：网络IO

前面提到Redis是基于内存操作的，因此它的瓶颈是物理机器的内存或网络带宽而并非CPU。

![image-20240309105939960](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403091059773.png)

现在服务器内存能达到16GB、32GB甚至更高。

随着网络硬件的性能提升，Redis的性能瓶颈有时会出现在网络IO的处理上，单个主线程处理网络请求的速度跟不上底层网络硬件的速度。

由于Redis的大部分操作都是在内存中完成的，因此IO操作通常成为性能瓶颈。通过采用IO多路复用（epoll技术），Redis能够更有效地处理网络IO，从而进一步提高其吞吐量。

Ngin也是使用IO多路复用（epoll技术）。

# Unix网络编程的五种IO模型

**Blocking IO 阻塞IO**

在阻塞IO模型中，进程发起一个IO操作后会被挂起，直到该操作完成为止。在此期间，进程不能进行其他任何操作。这是最传统也是最简单的IO模型。

**NoneBlocking IO  非阻塞IO**

非阻塞IO模型允许进程发起一个IO操作后不被阻塞，即进程可以继续执行其他操作。不过，进程需要不时地检查IO操作是否完成，通常通过轮询的方式进行。

**IO multiplexing IO多路复用**

l/O多路复用，经典的Reactor设计模式（基于事件驱动的设计模式），简单来说就是通过监听文件的读写事件再通知线程执行相关操作。

**signal driven IO 信号驱动IO**

信号驱动IO模型下，当某个IO操作准备就绪时，进程会收到一个信号。随后，进程可以通过系统调用来处理这个IO操作。

**asynchronous IO 异步IO**

异步IO模型是这五种模型中最复杂的一种。在此模型中，进程发起一个IO操作后便开始其他任务。当IO操作完成时，内核会自动将结果通知给进程，而无需进程主动查询或者等待信号。



## FileDescriptor文件描述符

FileDescriptor：文件描述符，简称FD，句柄

文件描述符（File descriptor)是计算机科学中的一个术语，是一个用于表述指向文件的引用的抽象化概念。文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，文件描述符这一概念往往只适用于UNIX、Linux这样的操作系统。

![image-20240309140234916](https://gitee.com/dongguo4812_admin/image/raw/master/image/202403091402623.png)

# IO多路复用

IO多路复用是一种同步的IO模型，实现一个线程监测多个文件句柄，一个某个文件句柄就绪就能够通知到对应应用程序进行相应的读写操作，没有文件句柄就绪时就会阻塞应用程序，从而释放CPU资源。

即使用单个线程监听多个连接请求。

IO：网络IO，在操作系统层面指数据在内核态和用户态之间的读写操作。

多路：指的是多个客户端连接，即多个socket。

复用指的是线程的复用，即一个线程可以同时处理多个客户端连接。

多路复用主要有三种技术：select、poll、epoll。

epoll是最新的也是目前最好的多路复用技术。采用多路l/O复用技术可以让单个线程高效的处理多个连接请求（尽量减少网络IO的时间消耗）。

